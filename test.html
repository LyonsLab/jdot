<html>
<body>

<canvas id="view">
Oops ... your web browser does not support HTML5!
</canvas>

<div>
    Number of points: <input id='num_points' size='15'>
    <button onclick='setPoints();'>Run</button><br>
    <!--Type: <button id='type' onclick='toggleType();'>Points</button> -->
</div>
<div>
    Use the mouse scroll to zoom and the arrow keys / drag mouse to move (when zoomed in).
</div>

<script src="src/dotplot2.js"></script>
<script src="src/quadtree.js"></script>
<script>
var initData = init_array;//init_qt;//init_array;
var fetchData = fetch_array;//fetch_qt;//fetch_array;

var gu1 = 2*1000*1000;
var gu2 = 3*1000*1000;

var canvas = document.getElementById('view');
var dp = new DotPlot(canvas, { size: { width: 500, height: 500 }, extent: { width: gu1, height: gu2 } });
dp.setFetch(fetchData);

var qt = QuadTree(gu1, gu2);

var data;
setPoints(100*1000);

canvas.onmousewheel = function(e) { dp.onmousewheel(e); };
canvas.onmousedown  = function(e) { dp.onmousedown(e);  };
canvas.onmouseup    = function(e) { dp.onmouseup(e);    };
canvas.onmousemove  = function(e) { dp.onmousemove(e);  };

//------------------------------------------------------------------------------
function init_qt(n) {
	console.log('init_qt ' + n);
    qt.clear();
    data = [];
    
    // Generate some random data points
    for (var i=0; i < n; i++) {
        var x = Math.random() * gu1;//dp.config.size.width;
        var y = Math.random() * gu2;//dp.config.size.height;
        data.push({ x: x, y: y, dataType: 'point' });
    }
    
    qt.insert(data);
}

function fetch_qt(x, y, width, height) {
    //var subset = qt.query_with_density( new rectangle(Math.ceil(x), Math.ceil(y), Math.ceil(width), Math.ceil(height)), canvas.width, canvas.height );
    var subset = qt.query( new rectangle(Math.ceil(x), Math.ceil(y), Math.ceil(width), Math.ceil(height)));
    console.log('fetch: ' + subset.length + ' ' + x + ' ' + y + ' ' + width + ' '  + height);
    //console.log(subset);
    return subset;
}

function init_array(n) {
	console.log(n);
    // Generate some random data points
    data = [];
    for (var i=0; i < n; i++) {
        var x = Math.floor( Math.random() * gu1 );
        var y = Math.floor( Math.random() * gu2 );
        data.push({ x: x, y: y, dataType: 'point' });
    }
}

function fetch_array(x, y, width, height) {
    return data;
}

function setPoints(n) {
	if (n) 
		document.getElementById('num_points').value = n;
	else
		n = document.getElementById('num_points').value;
	
	initData(n);
	dp.redraw();
}

function toggleType() {
    document.getElementById('type').innerHTML = 'Points';
    dp.redraw();
}

document.onkeydown = function(e) {
    switch(e.keyCode) {
        case 37: dp.translate( 5,  0 ); break; // left
        case 38: dp.translate( 0,  5 ); break; // up
        case 39: dp.translate( -5, 0 ); break; // right
        case 40: dp.translate( 0, -5 ); break; // down
    }
    
    dp.redraw();
};

</script>

</body>
</html>


